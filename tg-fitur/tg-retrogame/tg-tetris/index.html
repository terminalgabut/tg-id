<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tetris | Terminal Gabut</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

  <!-- ‚úÖ NAVBAR -->
  <header class="bg-blue-600 text-white fixed top-0 left-0 w-full shadow-md z-50">
    <nav class="flex justify-between items-center px-6 py-4">
      <div>
        <a href="../index.html">
          <img src="IMG_20250825_090756-removebg-preview.png" alt="Terminal Gabut Logo" class="h-7 w-auto">
        </a>
      </div>
      <ul class="hidden md:flex gap-6">
        <li><a href="../index.html" class="hover:text-blue-200">Home</a></li>
        <li><a href="#" class="hover:text-blue-200">Fitur</a></li>
      </ul>
      <button id="darkToggle" class="bg-white text-blue-600 px-3 py-1 rounded-md hover:bg-gray-200">
        üåô
      </button>
    </nav>
  </header>

  <!-- ‚úÖ GAME CONTAINER -->
  <div class="chat-container w-full max-w-4xl mx-auto mt-20 flex flex-col rounded-lg shadow-lg bg-white overflow-hidden">
    
    <!-- HEADER: Score, Lines, Level -->
    <div class="header-container bg-blue-600 text-white flex justify-around p-3 text-center">
      <div><h1 id="score">Score: 0</h1></div>
      <div><h1 id="lines">Lines: 0</h1></div>
      <div><h1 id="level">Level: 1</h1></div>
    </div>

    <!-- GAME CANVAS -->
    <div class="messages flex justify-center items-center bg-gray-100">
      <canvas id="tetris" width="240" height="400" class="bg-black rounded-lg"></canvas>
    </div>

    <!-- ‚úÖ GAMEPAD -->
    <div class="input-container grid grid-cols-3 gap-3 bg-white p-4">
      <button onclick="moveLeft()">‚¨ÖÔ∏è</button>
      <button onclick="moveUp()">‚¨ÜÔ∏è</button>
      <button onclick="moveRight()">‚û°Ô∏è</button>
      <button onclick="rotate()">üîÑ Rotate</button>
      <button onclick="drop()">‚¨áÔ∏è Hard Drop</button>
    </div>
  </div>

  <!-- ‚úÖ FOOTER -->
  <footer class="text-center py-6 text-gray-500">
    ¬© 2025 Terminal Gabut - Semua Hak Dilindungi
  </footer>

  <!-- ‚úÖ GAME SCRIPT -->
  <script>
    const canvas = document.getElementById("tetris");
    const context = canvas.getContext("2d");
    context.scale(20, 20);

    const scoreEl = document.getElementById("score");
    const linesEl = document.getElementById("lines");
    const levelEl = document.getElementById("level");

    const arena = createMatrix(12, 20);
    let dropCounter = 0;
    let dropInterval = 1000;
    let lastTime = 0;
    let score = 0;
    let lines = 0;
    let level = 1;

    const player = {
      pos: {x: 5, y: 0},
      matrix: null,
    };

    const colors = [
      null,
      "#FF0D72",
      "#0DC2FF",
      "#0DFF72",
      "#F538FF",
      "#FF8E0D",
      "#FFE138",
      "#3877FF",
    ];

    function createMatrix(w, h) {
      const matrix = [];
      while (h--) matrix.push(new Array(w).fill(0));
      return matrix;
    }

    function collide(arena, player) {
      const m = player.matrix;
      const o = player.pos;
      for (let y = 0; y < m.length; ++y) {
        for (let x = 0; x < m[y].length; ++x) {
          if (m[y][x] !== 0 &&
              (arena[y + o.y] &&
              arena[y + o.y][x + o.x]) !== 0) {
            return true;
          }
        }
      }
      return false;
    }

    function merge(arena, player) {
      player.matrix.forEach((row, y) => {
        row.forEach((value, x) => {
          if (value !== 0) {
            arena[y + player.pos.y][x + player.pos.x] = value;
          }
        });
      });
    }

    function playerDrop() {
      player.pos.y++;
      if (collide(arena, player)) {
        player.pos.y--;
        merge(arena, player);
        playerReset();
        arenaSweep();
        updateScore();
      }
      dropCounter = 0;
    }

    function drop() {
      while (!collide(arena, player)) {
        player.pos.y++;
      }
      player.pos.y--;
      merge(arena, player);
      playerReset();
      arenaSweep();
      updateScore();
      dropCounter = 0;
    }

    function moveLeft() {
      player.pos.x--;
      if (collide(arena, player)) player.pos.x++;
    }

    function moveRight() {
      player.pos.x++;
      if (collide(arena, player)) player.pos.x--;
    }

    function moveUp() {
      player.pos.y--;
      if (collide(arena, player)) player.pos.y++;
    }

    function rotate() {
      const m = player.matrix;
      for (let y = 0; y < m.length; ++y) {
        for (let x = 0; x < y; ++x) {
          [m[x][y], m[y][x]] = [m[y][x], m[x][y]];
        }
      }
      m.forEach(row => row.reverse());
      if (collide(arena, player)) {
        player.pos.x++;
        if (collide(arena, player)) player.pos.x -= 2;
      }
    }

    function arenaSweep() {
      outer: for (let y = arena.length - 1; y >= 0; --y) {
        for (let x = 0; x < arena[y].length; ++x) {
          if (arena[y][x] === 0) continue outer;
        }
        arena.splice(y, 1);
        arena.unshift(new Array(arena[0].length).fill(0));
        lines++;
        score += 100;
        if (lines % 10 === 0) {
          level++;
          dropInterval *= 0.9;
        }
      }
    }

    function drawMatrix(matrix, offset) {
      matrix.forEach((row, y) => {
        row.forEach((value, x) => {
          if (value !== 0) {
            context.fillStyle = colors[value];
            context.fillRect(x + offset.x, y + offset.y, 1, 1);
          }
        });
      });
    }

    function draw() {
      context.fillStyle = "#000";
      context.fillRect(0, 0, canvas.width, canvas.height);
      drawMatrix(arena, {x:0, y:0});
      drawMatrix(player.matrix, player.pos);
    }

    function playerReset() {
      const pieces = "TJLOSZI";
      player.matrix = createPiece(pieces[pieces.length * Math.random() | 0]);
      player.pos.y = 0;
      player.pos.x = (arena[0].length / 2 | 0) - (player.matrix[0].length / 2 | 0);
      if (collide(arena, player)) {
        arena.forEach(row => row.fill(0));
        score = 0;
        lines = 0;
        level = 1;
        dropInterval = 1000;
      }
    }

    function createPiece(type) {
      if (type === "T") return [[0,0,0],[1,1,1],[0,1,0]];
      if (type === "O") return [[2,2],[2,2]];
      if (type === "L") return [[0,3,0],[0,3,0],[0,3,3]];
      if (type === "J") return [[0,4,0],[0,4,0],[4,4,0]];
      if (type === "I") return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
      if (type === "S") return [[0,6,6],[6,6,0],[0,0,0]];
      if (type === "Z") return [[7,7,0],[0,7,7],[0,0,0]];
    }

    function update(time = 0) {
      const deltaTime = time - lastTime;
      lastTime = time;
      dropCounter += deltaTime;
      if (dropCounter > dropInterval) playerDrop();
      draw();
      requestAnimationFrame(update);
    }

    function updateScore() {
      scoreEl.innerText = "Score: " + score;
      linesEl.innerText = "Lines: " + lines;
      levelEl.innerText = "Level: " + level;
    }

    playerReset();
    updateScore();
    update();
  </script>
</body>
</html>